<div class="w-full max-w-7xl mx-auto p-6 bg-gray-50">
  <h1 class="text-3xl font-bold mb-6 text-gray-800">Analyse de R√©partition Salariale - ESN</h1>

  <!-- Banni√®re explicative -->
  <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg mb-6">
    <h3 class="font-semibold text-blue-800 mb-2">üìä Distribution Log-Normale</h3>
    <p class="text-sm text-blue-700">
      Cette courbe utilise une
      <strong>distribution log-normale</strong>
      (asym√©trique) pour mod√©liser la r√©partition des salaires dans une ESN.
      Elle montre une concentration de salaires plus faibles et une "queue longue" vers les salaires √©lev√©s,
      ce qui explique pourquoi la moyenne ({{ formatNumber(moyenne) }}‚Ç¨) est sup√©rieure √† la m√©diane
      ({{ formatNumber(mediane) }}‚Ç¨).
    </p>
  </div>

  <!-- Panneau de contr√¥le -->
  <div class="bg-white p-6 rounded-lg shadow-md mb-6">
    <h2 class="text-xl font-semibold mb-4 text-gray-700">Param√®tres</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Moyenne ESN (‚Ç¨)</label>
        <input
          (ngModelChange)="onParameterChange()"
          [(ngModel)]="moyenne"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
          step="100"
          type="number"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">M√©diane ESN (‚Ç¨)</label>
        <input
          (ngModelChange)="onParameterChange()"
          [(ngModel)]="mediane"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
          step="100"
          type="number"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Mon Salaire (‚Ç¨)</label>
        <input
          (ngModelChange)="onParameterChange()"
          [(ngModel)]="monSalaire"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500"
          step="100"
          type="number"
        />
      </div>
    </div>

    <!-- Statistiques -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
      <div class="text-xs text-gray-600 bg-gray-50 p-2 rounded">
        <p class="font-semibold">Esp√©rance:</p>
        <p class="text-lg font-bold text-gray-800">{{ formatNumber(esperance) }}</p>
      </div>
      <div class="text-xs text-gray-600 bg-gray-50 p-2 rounded">
        <p class="font-semibold">Ecart type:</p>
        <p class="text-lg font-bold text-gray-800">{{ formatNumber(ecartType) }}</p>
      </div>
      <div class="text-xs text-gray-600 bg-gray-50 p-2 rounded">
        <p class="font-semibold">Variance:</p>
        <p class="text-lg font-bold text-gray-800">{{ formatNumber(variance) }}</p>
      </div>
      <div class="text-xs text-gray-600 bg-gray-50 p-2 rounded">
        <p class="font-semibold">Asym√©trie:</p>
        <p class="text-lg font-bold text-gray-800">{{ formatNumber(asymetrie) }}</p>
      </div>
    </div>
  </div>

  <!-- Indicateurs cl√©s -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg">
      <p class="text-sm text-gray-600">Mon Salaire</p>
      <p class="text-2xl font-bold text-red-600">{{ formatNumber(monSalaire) }}‚Ç¨</p>
      <p class="text-xs text-gray-500 mt-1">Percentile: {{ monPercentile.toFixed(1) }}%</p>
    </div>
    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
      <p class="text-sm text-gray-600">M√©diane ESN</p>
      <p class="text-2xl font-bold text-blue-600">{{ formatNumber(mediane) }}‚Ç¨</p>
      <p [class]="'text-xs mt-1 font-semibold ' + (parseFloat(ecartMediane) < 0 ? 'text-red-600' : 'text-green-600')">
        √âcart: {{ ecartMediane }}%
      </p>
    </div>
    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
      <p class="text-sm text-gray-600">Moyenne ESN</p>
      <p class="text-2xl font-bold text-green-600">{{ formatNumber(moyenne) }}‚Ç¨</p>
      <p [class]="'text-xs mt-1 font-semibold ' + (parseFloat(ecartMoyenne) < 0 ? 'text-red-600' : 'text-green-600')">
        √âcart: {{ ecartMoyenne }}%
      </p>
    </div>
    <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-r-lg">
      <p class="text-sm text-gray-600">Position</p>
      <p class="text-2xl font-bold text-purple-600">{{ getPositionText() }}</p>
      <p class="text-xs text-gray-500 mt-1">
        {{ (100 - monPercentile).toFixed(0) }}% gagnent plus
      </p>
    </div>
  </div>

  <!-- Graphique de distribution -->
  <div class="bg-white p-6 rounded-lg shadow-md mb-6">
    <div class="flex justify-between items-start mb-4">
      <h2 class="text-xl font-semibold text-gray-700">Courbe de Distribution Salariale (Log-Normale)</h2>
      <div class="bg-purple-50 border-l-4 border-purple-500 p-3 rounded-r-lg">
        <p class="text-xs text-gray-600 mb-1">Rapport Interd√©cile (D9/D1)</p>
        <p class="text-2xl font-bold text-purple-600">{{ formatNumber(rapportInterdecile) }}</p>
        <p class="text-xs text-gray-500 mt-1">
          <span *ngIf="rapportInterdecile < 2"
                class="text-green-600">Faible in√©galit√©</span>
          <span *ngIf="rapportInterdecile >= 2 && rapportInterdecile < 3"
                class="text-yellow-600">In√©galit√© mod√©r√©e</span>
          <span *ngIf="rapportInterdecile >= 3"
                class="text-red-600">Forte in√©galit√©</span>
        </p>
      </div>
    </div>
    <app-salary-chart
      [data]="data"
      [deciles]="deciles"
      [mediane]="mediane"
      [monSalaire]="monSalaire"
      [moyenne]="moyenne">
    </app-salary-chart>
  </div>

  <!-- Tableau des d√©ciles -->
  <div class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-xl font-semibold mb-4 text-gray-700">Tableau des D√©ciles</h2>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left">D√©cile</th>
          <th class="px-4 py-2 text-left">Salaire (‚Ç¨)</th>
          <th class="px-4 py-2 text-left">Percentile</th>
          <th class="px-4 py-2 text-left">√âcart avec mon salaire</th>
          <th class="px-4 py-2 text-left">Statut</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let row of getSortedTableRows()"
            [class]="'border-t ' +
              (row.isMonSalaire ? 'bg-red-100 font-bold' : '') +
              (row.isMediane ? 'bg-blue-50 font-semibold' : '') +
              (row.isMoyenne ? 'bg-blue-50 font-semibold' : '') +
              (!row.isMonSalaire && !row.isMediane && !row.isMoyenne && row.valeur <= monSalaire ? 'bg-red-50' : '') +
              (!row.isMonSalaire && !row.isMediane && !row.isMoyenne && row.valeur > monSalaire ? 'bg-green-50' : '')">
          <td class="px-4 py-2 font-semibold">{{ row.label }}</td>
          <td class="px-4 py-2">{{ formatNumber(row.valeur) }}‚Ç¨</td>
          <td class="px-4 py-2">
            <span *ngIf="!row.isMoyenne">{{ row.percentile.toFixed(1) }}%</span>
            <span *ngIf="row.isMoyenne">~60-65%</span>
          </td>
          <td [class]="'px-4 py-2 font-semibold ' +
            (row.isMonSalaire ? 'text-gray-500' :
            (row.valeur > monSalaire ? 'text-red-600' : 'text-green-600'))">
            <span *ngIf="!row.isMonSalaire">
              {{ row.valeur > monSalaire ? '+' : '' }}{{ formatNumber(row.valeur - monSalaire) }}‚Ç¨
              ({{ row.valeur > monSalaire ? '+' : '' }}{{ (((row.valeur - monSalaire) / monSalaire) * 100).toFixed(1) }}
              %)
            </span>
            <span *ngIf="row.isMonSalaire"
                  class="text-gray-500">‚Äî</span>
          </td>
          <td class="px-4 py-2">
            <span *ngIf="row.isMonSalaire"
                  class="text-xs bg-red-200 text-red-900 px-2 py-1 rounded font-bold">Ma position</span>
            <span *ngIf="row.isMediane"
                  class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">R√©f√©rence</span>
            <span *ngIf="row.isMoyenne"
                  class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">R√©f√©rence</span>
            <span *ngIf="!row.isMonSalaire && !row.isMediane && !row.isMoyenne && row.valeur <= monSalaire"
                  class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">En dessous</span>
            <span *ngIf="!row.isMonSalaire && !row.isMediane && !row.isMoyenne && row.valeur > monSalaire"
                  class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Au dessus</span>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Interpr√©tation am√©lior√©e -->
  <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-r-lg mt-6">
    <h3 class="font-semibold text-yellow-800 mb-2">üí° Interpr√©tation</h3>
    <p class="text-sm text-yellow-700 mb-2">
      Ton salaire se situe au
      <strong>{{ monPercentile.toFixed(1) }}√®me percentile</strong>
      ,
      ce qui signifie que
      <strong>{{ (100 - monPercentile).toFixed(0) }}% des salari√©s</strong>
      de l'ESN
      gagnent plus que toi.
    </p>
    <p class="text-sm text-yellow-700 mb-2">
      Tu es √†
      <strong>{{ Math.abs(parseFloat(ecartMediane)) }}% en dessous de la m√©diane</strong>
      et √†
      <strong> {{ Math.abs(parseFloat(ecartMoyenne)) }}% en dessous de la moyenne</strong>
      .
    </p>
    <p class="text-sm text-yellow-700">
      <strong>‚ö†Ô∏è Point cl√© :</strong>
      La moyenne est sup√©rieure √† la m√©diane ({{ formatNumber(moyenne) }}‚Ç¨ vs {{ formatNumber(mediane) }}‚Ç¨),
      ce qui prouve que quelques salaires √©lev√©s tirent la distribution vers le haut.
      Tu te situes dans la partie "concentr√©e" de la courbe, o√π sont regroup√©s les salaires les plus faibles.
    </p>
  </div>
</div>

